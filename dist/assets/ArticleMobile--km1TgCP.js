import{j as e,u as s}from"./index-o4lGSIZO.js";import{r as t,b as a}from"./vendor-react-CyvzqkFf.js";import{c as i,I as n}from"./createLucideIcon-D_xG-gSw.js";import{u as r,b as l,c as o}from"./router-CSFsjDW6.js";import{A as c,H as d,S as h}from"./share-2-Sf0lRmA8.js";
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const m=i("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]]),u=i("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),p=i("Repeat2",[["path",{d:"m2 9 3-3 3 3",key:"1ltn5i"}],["path",{d:"M13 18H7a2 2 0 0 1-2-2V6",key:"1r6tfw"}],["path",{d:"m22 15-3 3-3-3",key:"4rnwn2"}],["path",{d:"M11 6h6a2 2 0 0 1 2 2v10",key:"2f72bc"}]]);
/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */function x({tabs:s=[],initialIndex:a=0,activeColor:i,onChange:n}){const[r,l]=t.useState(a),[o,c]=t.useState(0),d=t.useRef(null),h=t.useRef(null),m=t.useRef("none"),u=t.useRef(null),p=t.useRef(a),x=t.useMemo(()=>({transform:`translateX(${100*r}%)`}),[r]),j=t.useMemo(()=>({transform:`translateX(calc(${100*-r}% + ${o}px))`}),[r,o]);t.useEffect(()=>{var e;if(p.current===r)return;const s=(null==(e=u.current)?void 0:e.closest(".article-mobile"))||document.querySelector(".article-mobile");if(s){const e=Math.max(0,s.getBoundingClientRect().top+window.pageYOffset);try{window.scrollTo({top:e,behavior:"smooth"})}catch{window.scrollTo(0,e)}}if("function"==typeof n)try{n(r)}catch{}p.current=r},[r]);const f=i;return e.jsxs("div",{className:"swipe-tabs",ref:u,children:[e.jsxs("div",{className:"tab-bar",role:"tablist",children:[s.map((s,t)=>e.jsx("button",{className:"tab "+(t===r?"active":""),role:"tab","aria-selected":t===r,onClick:()=>l(t),style:t===r?i?{background:i,color:"#ffffff",borderColor:"transparent"}:void 0:f?{color:f}:void 0,children:s.label},s.key)),e.jsx("span",{className:"indicator",style:x})]}),e.jsx("div",{className:"panels",onTouchStart:e=>{d.current=e.touches[0].clientX,h.current=e.touches[0].clientY,m.current="none",c(0)},onTouchMove:e=>{if(null==d.current)return;const s=e.touches[0].clientX,t=e.touches[0].clientY,a=s-d.current,i=t-h.current;if("none"===m.current){const e=Math.abs(a),s=Math.abs(i);(e>10||s>10)&&(m.current=e>s+5?"horizontal":"vertical")}"horizontal"===m.current&&c(a)},onTouchEnd:()=>{var e;if(null!=d.current){if("horizontal"===m.current){const a=(null==(e=u.current)?void 0:e.offsetWidth)||0,i=a?Math.max(80,Math.min(140,.25*a)):120;let n=r;o<-i&&(n=r+1),o>i&&(n=r-1),l((t=n,Math.max(0,Math.min(t,s.length-1))))}var t;c(0),d.current=null,h.current=null,m.current="none"}},children:e.jsx("div",{className:"track",style:j,children:s.map(s=>e.jsx("section",{className:"panel",children:s.content},s.key))})})]})}function j(e){try{const s=new Date(e);if(isNaN(s.getTime()))return null;const t=Date.now()-s.getTime(),a=Math.max(0,Math.floor(t/1e3)),i=Math.floor(a/60),n=Math.floor(i/60),r=Math.floor(n/24);return r>0?1===r?"1 day ago":`${r} days ago`:n>0?1===n?"1 hour ago":`${n} hours ago`:i>0?1===i?"1 min ago":`${i} mins ago`:"just now"}catch{return null}}function f(){const i=r(),{id:f}=l(),g=o(),{theme:b}=s(),v=g.state&&g.state.article?g.state.article:null,[N,y]=t.useState(v),[w,k]=t.useState(""),[C,S]=t.useState("off"),[T,M]=t.useState(""),[A,$]=t.useState(""),[R,E]=t.useState([{id:"p1",name:"Alex Chen",handle:"@alex",time:"2h",text:"Love the angle on model latency. Curious how it affects agents at scale.",likes:12,comments:3,reposts:1,liked:!1},{id:"p2",name:"Sana R",handle:"@sana",time:"5h",text:"Great write-up. Would be awesome to see benchmarks with streaming enabled.",likes:7,comments:1,reposts:0,liked:!1},{id:"p3",name:"Jordan",handle:"@jordan",time:"1d",text:"Pricing drop is the real story. Opens up new use-cases for smaller teams.",likes:28,comments:4,reposts:2,liked:!1}]),[z,I]=t.useState([]),[P,L]=t.useState(""),[_,D]=t.useState(!1),[U,B]=t.useState(""),[H,W]=t.useState([]),[Y,q]=t.useState(1),O=a.useRef(null);if(t.useEffect(()=>{try{window.scrollTo({top:0,behavior:"auto"})}catch{window.scrollTo(0,0)}},[f]),t.useEffect(()=>{if(!(null==N?void 0:N.description))return;S("on");const e=setTimeout(()=>S("fading"),3e3),s=setTimeout(()=>S("off"),3800);return()=>{clearTimeout(e),clearTimeout(s)}},[null==N?void 0:N.description]),t.useEffect(()=>{let e=!0;return v&&v.citations||(async()=>{try{let s;if(f.startsWith("item")){const e=Number(f.replace("item",""));s=await fetch(`/api/news/by-index?i=${e}`)}else if(isNaN(f)){const e=decodeURIComponent(f);s=await fetch(`/api/news/by-title?title=${encodeURIComponent(e)}`)}else{const e=Number(f);s=await fetch(`/api/news/by-id/${e}`)}if(!s.ok){const e=await s.json().catch(()=>null);throw new Error((null==e?void 0:e.error)||`HTTP ${s.status}`)}const t=await s.json();e&&(y(e=>{var s,a;const i=Array.isArray(null==(s=t.item)?void 0:s.images)&&t.item.images.length?t.item.images[0]:null;return{...e,...t.item,image:(null==(a=t.item)?void 0:a.image)||(null==e?void 0:e.image)||i}}),k(""))}catch(s){e&&k(String(s.message||"Failed to load"))}})(),()=>{e=!1}},[f]),t.useEffect(()=>{I([]),L(""),W([]),B(""),q(1)},[f]),t.useEffect(()=>{P&&async function(e,s=!0){if(e){D(!0),B("");try{const t=`/api/chains/search?entity=${encodeURIComponent(e)}&require_id=${s?"true":"false"}`,a=await fetch(t);if(!a.ok){const e=await a.json().catch(()=>null);throw new Error((null==e?void 0:e.error)||`HTTP ${a.status}`)}const i=await a.json();W(Array.isArray(i.items)?i.items:[]),q(1)}catch(t){B(String(t.message||"Failed to load chains")),W([])}finally{D(!1)}}}(P,!0)},[P]),t.useEffect(()=>{const e=O.current;if(!e)return;const s=new IntersectionObserver(e=>{for(const s of e)s.isIntersecting&&q(e=>20*e>=H.length?e:e+1)},{root:null,rootMargin:"200px",threshold:0});return s.observe(e),()=>s.disconnect()},[H]),w)return e.jsxs("div",{className:"article-mobile",children:[e.jsxs("div",{className:"topbar",children:[e.jsx("button",{className:"icon-btn",onClick:()=>i(-1),"aria-label":"Back",children:e.jsx(c,{size:18})}),e.jsx("h1",{children:"Not found"}),e.jsx("span",{style:{width:36}})]}),e.jsxs("p",{style:{padding:16},children:["Path: ",f]}),e.jsx("p",{style:{padding:16},children:w})]});if(!N)return e.jsxs("div",{className:"article-mobile",children:[e.jsxs("div",{className:"topbar",children:[e.jsx("button",{className:"icon-btn",onClick:()=>i(-1),"aria-label":"Back",children:e.jsx(c,{size:18})}),e.jsx("h1",{children:"Loading…"}),e.jsx("span",{style:{width:36}})]}),e.jsx("p",{style:{padding:16},children:"Fetching article…"})]});const X=[{key:"summary",label:"Summary",content:e.jsxs("div",{children:[N.image&&e.jsx(n,{src:N.image,alt:"",style:{height:220}}),e.jsxs("div",{className:"content",children:[e.jsx("h2",{children:N.title}),N.description&&(()=>{const s=N.description,t=s.slice(0,220),a=s.slice(220);return e.jsxs("p",{className:"text-muted description",style:{marginTop:8},children:[e.jsx("span",{children:t}),a&&e.jsx("span",{className:`desc-tail ${"on"===C?"highlight":""} ${"fading"===C?"fade":""}`,children:a})]})})(),e.jsxs("p",{className:"text-muted",style:{marginTop:12},children:[N.sourcesCount," sources"]}),Array.isArray(N.citations)&&N.citations.length>0&&e.jsxs("div",{className:"citations",children:[e.jsx("div",{className:"citations-head",children:"Sources & Citations"}),e.jsx("div",{className:"citations-row",role:"list",onTouchStart:e=>e.stopPropagation(),onTouchMove:e=>e.stopPropagation(),onTouchEnd:e=>e.stopPropagation(),children:N.citations.map((s,t)=>{const a=(()=>{try{return new URL(s.url).hostname.replace(/^www\./,"")}catch{return s.url}})();return e.jsxs("a",{className:"citation-card",role:"listitem",href:s.url,target:"_blank",rel:"noreferrer",children:[e.jsxs("div",{className:"citation-top",children:[s.favicon?e.jsx("img",{src:s.favicon,alt:"",className:"citation-ico"}):e.jsx("div",{className:"citation-ico placeholder"}),e.jsx("div",{className:"citation-title",children:s.title||a})]}),e.jsx("div",{className:"citation-host",children:a})]},t)})})]})]})]})},{key:"opinion",label:"Opinion",content:e.jsx("div",{className:"content",children:e.jsxs("div",{className:"community",children:[e.jsxs("div",{className:"composer",children:[e.jsx("div",{className:"avatar","aria-hidden":"true",children:"You"}),e.jsxs("div",{className:"composer-main",children:[e.jsx("textarea",{className:"composer-input",placeholder:"Share your thoughts…",value:A,onChange:e=>$(e.target.value),rows:2}),e.jsx("div",{className:"composer-actions",children:e.jsx("button",{className:"post-btn",disabled:!A.trim(),onClick:()=>{const e=A.trim();e&&(E(s=>[{id:"p"+Date.now(),name:"You",handle:"@you",time:"just now",text:e,likes:0,comments:0,reposts:0,liked:!1},...s]),$(""))},children:"Post"})})]})]}),e.jsx("div",{className:"thread",role:"list",children:R.map(s=>{var t,a,i;return e.jsxs("article",{className:"post-card",role:"listitem",children:[e.jsxs("div",{className:"post-meta",children:[e.jsx("div",{className:"avatar","aria-hidden":"true",children:(s.name||"U").slice(0,2)}),e.jsxs("div",{className:"who",children:[e.jsxs("div",{className:"name-line",children:[e.jsx("strong",{className:"name",children:s.name}),e.jsx("span",{className:"handle",children:s.handle}),e.jsx("span",{className:"dot",children:"·"}),e.jsx("span",{className:"time",children:s.time})]}),e.jsx("div",{className:"post-text",children:s.text})]})]}),e.jsxs("div",{className:"post-actions",children:[e.jsxs("button",{className:"icon-text","aria-label":"Comment",children:[e.jsx(u,{size:16})," ",e.jsx("span",{children:null!=(t=s.comments)?t:0})]}),e.jsxs("button",{className:"icon-text "+(s.liked?"liked":""),"aria-label":"Like",onClick:()=>{E(e=>e.map(e=>e.id===s.id?{...e,liked:!e.liked,likes:(e.likes||0)+(e.liked?-1:1)}:e))},children:[e.jsx(d,{size:16})," ",e.jsx("span",{children:null!=(a=s.likes)?a:0})]}),e.jsxs("button",{className:"icon-text","aria-label":"Repost",children:[e.jsx(p,{size:16})," ",e.jsx("span",{children:null!=(i=s.reposts)?i:0})]}),e.jsx("button",{className:"icon-text","aria-label":"Share",children:e.jsx(h,{size:16})})]})]},s.id)})})]})})},{key:"chains",label:"Chains",content:e.jsxs("div",{children:[z.length>0&&e.jsx("div",{style:{padding:"8px",display:"flex",gap:8,flexWrap:"wrap"},children:z.map(s=>e.jsx("button",{className:"chip "+(P===s?"active":""),onClick:()=>L(s),style:{padding:"6px 10px",borderRadius:999,border:"1px solid #ddd",background:P===s?N.bgColor||N.bgColorDark||"#222":"transparent",color:P===s?"#fff":"inherit"},children:s},s))}),e.jsxs("div",{className:"content",children:[_&&e.jsx("p",{className:"text-muted",children:"Loading…"}),U&&!_&&e.jsx("p",{className:"text-muted",children:U}),!_&&0===H.length&&!U&&e.jsx("p",{className:"text-muted",children:"No results."})]}),e.jsxs("div",{className:"feed-list",role:"list",children:[H.slice(0,20*Y).map((s,t)=>{const a=Array.isArray(s.images)&&s.images.length?s.images[0]:Array.isArray(s.image_url)&&s.image_url.length?s.image_url[0]:null,i=Boolean(s.bgColor||s.bgColorDark),r=i?"dark"===b?s.bgColorDark||s.bgColor:s.bgColor||s.bgColorDark:void 0,l="feed-card card "+(i?"has-color":"");return e.jsxs("article",{className:l,role:"listitem",style:{background:r,border:"1px solid var(--border)"},children:[a&&e.jsxs("div",{className:"hero-wrap",children:[e.jsx(n,{src:a,alt:"",className:"hero",style:{height:220}}),s.timestamp&&e.jsx("div",{className:"age-badge","aria-label":"Published age",children:j(s.timestamp)})]}),e.jsxs("div",{className:"content",children:[e.jsx("h3",{children:s.title||"Untitled"}),e.jsx("div",{className:"divider"}),s.description&&e.jsx("p",{className:"description",children:s.description}),Array.isArray(s.page_url)&&s.page_url.length>0&&e.jsx("div",{style:{marginTop:8,display:"flex",gap:8,flexWrap:"wrap"},children:s.page_url.slice(0,4).map((s,t)=>e.jsxs("a",{href:s,target:"_blank",rel:"noreferrer",className:"chip",style:{border:"1px solid #ddd",padding:"6px 10px",borderRadius:999,display:"inline-flex",alignItems:"center",gap:6},children:[e.jsx(m,{size:14})," Link ",t+1]},t))})]})]},t)}),e.jsx("div",{ref:O})]})]})}];return T.trim().length,e.jsxs("div",{className:"article-mobile",children:[e.jsxs("div",{className:"topbar",children:[e.jsx("button",{className:"icon-btn",onClick:()=>{try{if(window.history.length>1)return void window.history.back()}catch{}i(-1)},"aria-label":"Back",children:e.jsx(c,{size:18})}),e.jsx("h1",{children:"Article"}),e.jsx("span",{style:{width:36}})]}),e.jsx(x,{tabs:X,initialIndex:0,activeColor:N.bgColor||N.bgColorDark||void 0,onChange:function(e){2===e&&(0!==z.length||isNaN(f)||async function(e){try{const s=await fetch(`/api/news/entities/${e}`);if(!s.ok)throw new Error(`HTTP ${s.status}`);const t=await s.json(),a=Array.isArray(t.entities)?t.entities:[];I(a),a.length>0&&L(e=>e||a[0])}catch(s){I([])}}(Number(f)))}})]})}export{f as default};
